<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cadastro de Cliente - Dropers</title>
  <link rel="stylesheet" href="/css/aside.css">
  <link rel="stylesheet" href="/css/admin.css">
  <link rel="stylesheet" href="/css/register.css">
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600;700&display=swap" rel="stylesheet">


  <script>
    // Verifica se o usuário ainda está logado
    fetch('/admin/users-json')
      .then(res => {
        if (res.status === 403) {
          window.location.href = '/login.html';
        }
      })
      .catch(() => window.location.href = '/login.html');
  </script>
</head>

<body class="dark">
  <!-- MENU LATERAL -->
  <aside>
    <div>
      <div class="logo">LOCO</div>
      <nav>
        <ul>
          <li><a href="/home"><span class="material-symbols-outlined">home</span></a></li>
          <li><a href="/admin/users"><span class="material-symbols-outlined">group</span></a></li>
          <li><a href="/register" class="active"><span class="material-symbols-outlined">person_add</span></a></li>
          <li><a href="/logout"><span class="material-symbols-outlined">exit_to_app</span></a></li>
        </ul>
      </nav>
    </div>
    <div class="profile">
      <img src="https://i.pravatar.cc/35" alt="Profile">
      <span>Admin</span>
    </div>
  </aside>

  <!-- CONTEÚDO PRINCIPAL -->
  <main>
    <div class="main-container">
      <!-- FORMULÁRIO -->
      <div class="form-area">
        <div class="form-header-title">
          <h2>Cadastro de Cliente</h2>
          <p>Preencha os dados abaixo para cadastrar um novo cliente.</p>
        </div>

        <form id="formCadastro">
          <!-- OBRIGATÓRIOS -->
          <div class="form-group">
            <label for="name">Nome Completo:</label>
            <input type="text" id="name" name="name" required>
          </div>

          <div class="form-group">
            <label for="email">E-mail:</label>
            <input type="email" id="email" name="email" required>
          </div>

          <div class="form-group">
            <label for="password">Senha:</label>
            <input type="password" id="password" name="password" required>
          </div>

          <!-- EXTRAS -->
          <div class="form-group">
            <label for="cpfCnpj">CPF ou CNPJ:</label>
            <input type="text" id="cpfCnpj" name="cpfCnpj">
          </div>

          <div class="form-group">
            <label for="telefone">Telefone:</label>
            <input type="text" id="telefone" name="telefone">
          </div>

          <div class="form-group">
            <label for="celular">Celular:</label>
            <input type="text" id="celular" name="celular">
          </div>

          <div class="form-group">
            <label for="site">Site:</label>
            <input type="url" id="site" name="site">
          </div>

          <div class="form-group">
            <label for="nivelVendedor">Nível do Vendedor:</label>
            <select id="nivelVendedor" name="nivelVendedor">
              <option value="">Selecione</option>
              <option value="Iniciante CPF">Iniciante CPF</option>
              <option value="Simples Nacional">Simples Nacional</option>
              <option value="Lucro Presumido">Lucro Presumido</option>
              <option value="Lucro Real">Lucro Real</option>
            </select>
          </div>

          <div class="form-group">
            <label for="cep">CEP:</label>
            <input type="text" id="cep" name="cep">
          </div>

          <div class="form-group">
            <label for="endereco">Rua:</label>
            <input type="text" id="endereco" name="endereco">
          </div>

          <div class="form-group">
            <label for="numeroCasa">Número:</label>
            <input type="text" id="numeroCasa" name="numeroCasa">
          </div>

          <div class="form-group">
            <label for="bairro">Bairro:</label>
            <input type="text" id="bairro" name="bairro">
          </div>

          <div class="form-group">
            <label for="cidade">Cidade:</label>
            <input type="text" id="cidade" name="cidade">
          </div>

          <div class="form-group">
            <label for="estado">Estado:</label>
            <input type="text" id="estado" name="estado">
          </div>

          <div class="form-group">
            <label for="observacoes">Observações:</label>
            <textarea id="observacoes" name="observacoes"></textarea>
          </div>

          <div class="form-navigation-buttons">
            <button type="button" class="back-button" onclick="window.location.href='/'">Voltar</button>
            <button type="submit" class="submit-button">Cadastrar</button>
          </div>
        </form>
      </div>

      <!-- PREVIEW DO CARTÃO -->
      <div class="card-preview" id="previewCard">
        <div class="avatar" id="previewAvatar">?</div>
        <h3 id="previewName">Nome do Cliente</h3>
        <p id="previewEmail">email@exemplo.com</p>
        <p id="previewTelefone">(00) 0000-0000</p>
        <p id="previewSite">seusite.com</p>
      </div>
    </div>
  </main>

  <script>
    // Atualiza preview em tempo real
    function updatePreview(id, previewId, placeholder, avatar = false) {
      const input = document.getElementById(id);
      input.addEventListener("input", () => {
        const value = input.value.trim();
        document.getElementById(previewId).textContent = value || placeholder;
        if (avatar) {
          document.getElementById(previewId).textContent = value ? value[0].toUpperCase() : "?";
        }
      });
    }

    updatePreview("name", "previewName", "Nome do Cliente");
    updatePreview("name", "previewAvatar", "?", true);
    updatePreview("email", "previewEmail", "email@exemplo.com");
    updatePreview("telefone", "previewTelefone", "(00) 0000-0000");
    updatePreview("site", "previewSite", "seusite.com");

    // Envio do formulário
    document.getElementById("formCadastro").addEventListener("submit", async (e) => {
      e.preventDefault();
      const formData = new FormData(e.target);
      const data = Object.fromEntries(formData.entries());

      const res = await fetch("/addClient", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data)
      });

      if (res.ok) {
        alert("✅ Cliente cadastrado com sucesso!");
        window.location.href = "/admin/users";
      } else {
        const txt = await res.text();
        alert("❌ Erro ao cadastrar: " + txt);
      }
    });
  </script>
</body>
</html>
